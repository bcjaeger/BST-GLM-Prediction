<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Prediction with Generalized Linear Models</title>
    <meta charset="utf-8" />
    <meta name="author" content="Byron C. Jaeger, rstats enthusiast" />
    <meta name="date" content="2019-10-01" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Prediction with Generalized Linear Models
### Byron C. Jaeger, rstats enthusiast
### October 1, 2019

---




# Hello! My name is Byron 

.left-column[

I like running, walking my dog, bad margaritas, Rocket League, and (of course) R.

I study &lt;br/&gt; machine learning, missing data, ambulatory blood pressure, and cardiovascular disease.

]

.right-column[

&lt;img src="figs/run_R_kids.png" width="100%" align="right" /&gt;

]


---

background-image: url(figs/tidyverse.png)
background-position: 95% 2.5%
background-size: 13%

# Objectives

Have a lively discussion about

--

### 1. End-points of inference/prediction 

--

### 2. Why inferential analysis must be set apriori

--

### 3. The bias-variance tradeoff principle

--

### 4. Cross-validation: Doing it right

*(Bonus)* Apply R packages from the `tidyverse` 

---
class: inverse, middle, center

# End-points of inference/prediction

---

## **Data analysis** 

Usually oriented toward prediction or inference. 

--

### **Statistical inference**

- Forming judgments about the parameters of a population.

- Hypothesis driven (exploring is frowned upon; you'll see)

- End-point is often a policy (smoking, blood pressure &gt;140/90 mm Hg)

--

### **Predictive analytics** 

- Applying predictive models to support tasks that involve uncertainty.

- Performance driven (exploring is necessary and easy to mess up)

- End-point is often a data product (Facebook, Google, etc...)


---
class: middle, center

# Analysis end-points

&lt;img src="Intro_to_Predictive_Analytics_files/data_analysis_flow.jpg" width="90%" /&gt;

---
class: middle, center

# Data product demo

### https://bcjaeger.shinyapps.io/DPE4NHTN_WebApp/

---
class: inverse, middle, center

# Why inference must be apriori

---


## **Stepwise model selection**

It's used for statistical inference *all*. *the*. *time*.

--

**Question:**

Why do you think I am going to tell you it shouldn't be?

*Hint:* The answer you expect from a stats / R enthusiast.

--

Because I can demonstrate it with simulations in R.


```r
# seed; number of obs; number of predictors
set.seed(32987); nobs &lt;- 250; nprd &lt;- 1000
# outcome
y &lt;- rnorm(n = nobs)
# predictors (No correlation to y)
X &lt;- mvrnorm(
  n = nobs, 
  mu = rep(0, nprd), # zero mean
  Sigma = diag(1, ncol = nprd, nrow = nprd) # independent
) %&gt;% 
  set_colnames(glue("x{1:nprd}")) %&gt;% 
  as_tibble()
```

---

## Peek at `y` and `X`


```r
hist(y)
```

![](index_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;


---

## Peek at `y` and `X`


```r
X[,1:8]
```

```
## # A tibble: 250 x 8
##          x1      x2     x3     x4      x5     x6      x7     x8
##       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 -0.00277  0.261   0.458 -0.307  0.0243 -0.980  0.523  -0.633
##  2  1.29    -1.85   -0.575  0.399  0.333  -0.629 -0.245   0.425
##  3  0.00118 -0.748  -0.133 -0.346  0.598  -1.76   0.341  -0.292
##  4 -0.728   -1.27    0.971 -0.555 -0.888   0.601 -1.15   -0.189
##  5  1.12     1.17   -2.21   0.498 -0.404  -0.638  0.722  -0.278
##  6 -0.256   -1.73    1.02   1.04  -0.574   0.538 -0.905   0.103
##  7  0.181   -0.0631  0.649 -0.369 -0.452  -0.858  0.0441 -0.994
##  8 -0.174   -1.14    2.71   1.43  -0.201  -2.27  -0.167   0.475
##  9 -0.172   -1.19    0.363  0.101  0.176   0.533 -1.11    0.964
## 10  0.640    0.423  -0.936 -1.55   0.201   0.333  0.192  -0.670
## # ... with 240 more rows
```

---

## Step-wise FTL (for the loss)

- Yes. I am trash talking step-wise models for inference

- No. I am not trash talking step-wise models in general.

- The function in `MASS` is very nicely done (Thank you, Brian Ripley!).


```r
data &lt;- bind_cols(y=y, X)
full &lt;- glue("y ~ {glue_collapse(names(X), sep = '+')}")

mdl &lt;- stepAIC(
  object = lm(y ~ 1, data = data),
  scope = as.formula(full),
  direction = 'both',
  steps = 10,
  trace = 0
)
```

--

We'll check the model inferences using


```r
summary(mdl)
```

but first...

---
class: center, middle

# Guess the type I error rate!

---


```
## 
## Call:
## lm(formula = y ~ x558 + x539 + x638 + x176 + x59 + x234 + x252 + 
##     x152 + x179 + x84, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.69559 -0.51995  0.00984  0.52192  1.86829 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.09489    0.04924  -1.927 0.055155 .  
## x558         0.17430    0.04892   3.563 0.000443 ***
## x539         0.19851    0.04684   4.238 3.22e-05 ***
## x638        -0.15261    0.05084  -3.002 0.002966 ** 
## x176         0.21159    0.05315   3.981 9.11e-05 ***
## x59          0.17640    0.04795   3.679 0.000289 ***
## x234         0.19411    0.05159   3.762 0.000212 ***
## x252        -0.16019    0.04924  -3.254 0.001304 ** 
## x152         0.18357    0.04907   3.741 0.000230 ***
## x179        -0.16660    0.05292  -3.148 0.001851 ** 
## x84         -0.15220    0.05228  -2.911 0.003940 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.767 on 239 degrees of freedom
## Multiple R-squared:  0.311,	Adjusted R-squared:  0.2821 
## F-statistic: 10.79 on 10 and 239 DF,  p-value: 4.34e-15
```

---
class: center, middle

# Collaborator:

### How about we use stepwise model selection to identify factors associated with Y?

---
class: inverse
background-image: url(gifs/sloth_no.gif)
background-size: 90%

# You:

---

# But what **should** we do?

Use predictive modeling techniques for predictive modeling problems


```r
cv_net &lt;- cv.glmnet(x = as.matrix(X), y = y)

plot(cv_net)
```

![](index_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

---

# And why did **this** work?


```r
cv_net &lt;- cv.glmnet(x = as.matrix(X), y = y)

plot(cv_net)
```

--

*Hint*: It is one of these:

*Potential Answer 1:* 

Because `glmnet` was the right predictive modeling technique.

*Potential Answer 2:* 

Because `cv` (cross-validation) was the right predictive modeling technique.

---
class: inverse, middle, center

# Bias-Variance Tradeoff

---
layout: true

# The bias-variance tradeoff

---

---

### What is it?

 You may recognize the terms bias and variance if you have some experience with statistics.

--

- Bias: difference between observed and predicted values (in training data)

- Variance: measure of dispersion in the distribution of predicted values.

These are correct (but not helpful) definitions.

---

### What is it?

You may recognize the terms bias and variance if you have some experience with statistics.

- Bias: how well does a model predict its training data?

- Variance: how complex is the model?

These are incorrect (but helpful) definitions.

--

*Fact:* Reducing bias generally increases variance. 

--

*Unfair question:* Does reducing bias reduce prediction error for new data?

--

Let's work through an example to demonstrate why this question is unfair

---

**Example:** Given a training set of 25 observations, develop a prediction rule that minimizes squared error for a testing set of 25,000 observations. 

![](index_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---




```r
# spar = 1 =&gt; least complex spline
model &lt;- gam(y ~ s(x, spar=1), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.95 =&gt; a little more wiggle room
model &lt;- gam(y ~ s(x, spar=0.95), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.90 =&gt; a little more wiggle room
model &lt;- gam(y ~ s(x, spar=0.90), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;
---


```r
# spar = 0.85 =&gt; more 
model &lt;- gam(y ~ s(x, spar=0.85), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;
---


```r
# spar = 0.80 =&gt; more 
model &lt;- gam(y ~ s(x, spar=0.80), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.75 =&gt; more 
model &lt;- gam(y ~ s(x, spar=0.75), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;
---


```r
# spar = 0.70 =&gt; more
model &lt;- gam(y ~ s(x, spar=0.70), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.65 =&gt; more (too much?)
model &lt;- gam(y ~ s(x, spar=0.65), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.60 =&gt; more (too much?)
model &lt;- gam(y ~ s(x, spar=0.60), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;
---


```r
# spar = 0.55 =&gt; more (too much?)
model &lt;- gam(y ~ s(x, spar=0.55), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-31-1.png)&lt;!-- --&gt;
---


```r
# spar = 0.50 =&gt; more (too too much??)
model &lt;- gam(y ~ s(x, spar=0.50), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-33-1.png)&lt;!-- --&gt;
---

```r
# spar = 0.45 =&gt; more (much too much!!)
model &lt;- gam(y ~ s(x, spar=0.45), data=simulated_data)
```

![](index_files/figure-html/unnamed-chunk-35-1.png)&lt;!-- --&gt;

---
layout: false
class: center, middle

# In summary

---
layout: false
background-image: url(gifs/dog_gate_subbed.gif)
background-size: 70%

---
layout: false
class: inverse, middle, center

# Cross validation

## (Monte-Carlo)

---
layout: true
background-image: url(figs/tidymodels.png)
background-position: 95% 2.5%
background-size: 13%

# Monte-Carlo Cross Validation

---

### Step-by-step example

**Problem:** Develop a data product that predicts the selling price of houses in Sacramento, CA.

--

**Why?** Real estate agents operate on these numbers. The more accurate price estimates are, the more likely it is that buyers and sellers will be able to strike a deal.

--

**Data:** `Sacramento`, a publically available dataset from the `caret` R package. 

**Description:** This data frame contains house and sale price data for 932 homes in Sacramento CA. The original data were obtained from the website for the SpatialKey software. From their website: "The Sacramento real estate transactions file is a list of 985 real estate transactions in the Sacramento area reported over a five-day period, as reported by the Sacramento Bee." Google was used to fill in missing/incorrect data.

---

A look at the data

<div id="htmlwidget-c57f86b0ce440612b83d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c57f86b0ce440612b83d">{"x":{"filter":"none","data":[[2,3,2,2,2,3,3,3,2,3,3,3,1,3,2,2,2,2,2,3,3,4,4,3,3,3,3,3,4,3,2,3,3,3,2,3,3,4,4,1,2,3,3,2,4,4,4,4,4,3,3,4,3,4,3,3,4,3,3,4,3,3,4,3,3,3,3,3,4,3,4,3,3,2,3,4,4,2,5,4,3,3,4,4,4,3,3,3,3,3,3,5,3,4,2,3,4,5,3,3,4,3,3,3,4,3,2,4,8,4,4,3,2,4,5,3,2,5,4,5,5,4,4,2,3,4,3,3,4,3,4,4,3,3,4,3,5,5,4,4,3,4,3,4,3,5,5,6,5,4,4,5,4,5,4,4,3,6,2,4,2,2,2,3,4,3,2,3,2,3,2,1,3,1,3,3,3,2,3,3,3,3,3,3,3,2,3,3,3,3,2,3,2,2,4,3,4,3,3,3,4,2,3,2,2,2,3,2,3,3,3,3,3,3,2,3,4,4,3,4,3,3,3,3,4,3,4,3,4,2,2,2,4,3,3,3,3,4,3,4,4,3,2,3,3,3,3,2,3,3,4,2,3,3,4,3,3,5,3,4,3,4,4,4,4,4,3,4,4,4,4,3,4,3,3,3,3,4,2,3,4,3,4,3,3,3,5,4,2,3,3,2,4,3,4,4,4,3,4,4,5,4,5,3,4,4,5,5,4,3,5,5,2,4,3,3,4,4,5,5,2,4,4,4,3,5,3,5,4,4,4,5,5,4,2,1,3,2,2,2,2,2,2,2,3,2,3,3,2,2,3,2,4,1,2,4,3,3,4,3,2,2,2,3,3,4,2,2,3,2,3,3,3,2,4,4,2,2,4,3,2,2,3,3,3,3,4,3,5,2,3,3,3,3,4,3,3,2,2,3,2,3,4,4,3,3,4,3,3,3,3,3,4,2,3,3,3,3,3,3,3,3,2,4,4,4,3,4,2,4,4,3,3,3,2,4,3,3,4,3,4,3,2,4,3,2,3,3,2,4,5,3,3,4,4,4,5,4,3,4,4,4,3,3,4,3,4,2,3,4,4,4,4,3,3,4,3,3,4,4,3,3,3,2,4,3,5,4,4,3,4,5,4,3,4,3,3,5,5,5,4,3,4,4,3,3,4,4,5,4,2,4,3,3,3,4,2,4,3,5,3,5,3,3,4,3,4,4,4,4,2,3,4,4,5,3,4,4,3,3,4,3,3,2,5,4,5,4,4,5,3,5,5,3,1,2,2,2,2,2,2,2,2,2,2,3,2,2,4,2,4,2,1,3,3,3,3,3,4,3,4,3,4,3,2,4,3,3,3,3,2,3,3,4,3,3,3,4,6,3,3,4,3,4,3,3,5,4,3,3,3,3,3,3,3,3,3,4,3,3,3,3,3,3,4,3,4,3,3,3,3,4,2,3,3,3,3,4,4,2,3,3,3,3,3,4,3,2,3,4,4,3,3,1,3,4,3,3,4,3,4,2,2,4,3,2,4,3,2,5,3,4,4,3,3,5,3,4,3,4,4,3,2,3,4,3,4,3,3,3,4,3,3,3,4,3,3,3,4,3,3,3,3,4,2,3,4,3,5,3,4,5,3,4,3,3,4,3,4,4,3,4,4,3,4,2,2,3,6,3,5,3,4,3,3,4,4,5,3,4,4,5,3,4,3,4,4,3,3,3,2,4,4,4,3,3,4,5,5,5,3,2,3,3,3,3,4,4,5,3,3,3,5,5,3,4,5,5,4,4,2,3,4,3,3,5,5,5,5,4,4,4,3,3,3,4,5,4,3,4,3,4,2,4,5,5,4,4,4,5,5,3,4,4,4,1,2,2,2,2,4,3,2,2,3,3,3,3,1,3,3,3,3,3,3,2,4,3,2,4,3,3,3,3,4,2,3,3,1,3,3,3,2,3,4,2,3,3,3,3,3,4,3,2,4,4,3,3,3,2,4,3,3,2,3,2,3,3,4,4,3,1,3,3,3,4,4,3,3,3,3,3,3,3,1,3,4,4,2,3,2,2,3,3,3,4,3,3,3,3,3,3,3,3,4,4,4,3,3,3,3,3,3,3,4,4,3,4,3,3,4,3],[1,1,1,1,1,1,2,1,2,2,2,2,1,1,2,2,1,1,1,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,1,3,2,2,2,1,2,2,2,2,4,2,2,2,1,3,2,2,2,2,3,2,2,2,2,2,3,2,2,2,2,3,1,3,2,2,2,2,2,3,2,1,2,2,2,1,3,2,2,3,4,2,2,2,1,4,3,2,2,3,2,3,4,3,3,1,3,3,3,2,2,3,2,3,3,3,3,2,3,3,2,2,3,3,2,3,3,3,3,4,3,3,3,4,2,3,4,3,3,5,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,2,1,2,2,1,1,2,2,1,2,2,2,2,1,2,2,2,1,2,2,2,2,2,1,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1.5,2,2,2,2,3,1,1.5,1,2,2,3,1,2,2,2,2,2,1,2,2,2,2,1,2,2.5,2,3,1,2.5,2,2,2,2,4,2,2,2,3,2,3,2.5,3,2,3,3,2,3,2,2,2,2,2,2,4,2.5,1,3,2,2,2,2.5,2,3,2,2,2,2,1,3,1,2,2,3,2,2,2,3,2,4,2,2,3,4,4,2,3,4,3,1,2,1,2,3,4,3,4,2,3,3,2.5,3,3,2,3,2,3,3.5,5,2,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,2,1,2,4,1,2,2,2,1,2,2,1,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,1,2,1,2,1,2,3,2,1,2,2,2,3,1,2,2,1,3,2,1,2,2,2,2,1,3,2,2,1,2,2,3,4,2,2,2,3,2,3,2,2,3,2,2,1,2,2,2,2,2,3,3,2,2,2,1,2,3,2,2,3,2,3,2,2,2,2,2,3,2,2,2,2,3,3,2.5,2,2,2,3,3,3,2,3,3,2,2,2,2,2,3.5,2,2,2,2,1,2,3,2,2.5,2,3.5,1,3,2,2.5,3,2,2,3,3,2,3,2,2,4,3,2,3.5,4,3,3,3.5,2,2,2,4,2,2,3,3,3,2,3,3,2,2,1,1,1,1,1,2,1,1,1,1,2,1,1,2,1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,1,1,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,3,2.5,1,1,2,1,1,2,2,1,2,2,2,2,2,1,2.5,2,2,2,1,2,2,1,1,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,2,3,2,2,2,2,2,2,2,2.5,2,2,3,2,2,2,2,2,1,2,2,2,2,2,2,2.5,2,2.5,2.5,2,3,2,3,3,2,2,2,2,3,2,2,2,2,2,2,2,2,1,2,2,3,2,3,2,2,2,2,3,2,3,2.5,2,3,3,2,2.5,2,3,2,3,2,2,2,3,2,3,3,2,2,3,3,3,2,2,2,2,2,2.5,2,3,3,1,2,2,4.5,3,2,3,3,4,2,3,1,2,3,1,2,4,3,3,3,3,2,3,2.5,2,2,2.5,4,3,2,3,1,3.5,1,3,4,5,3,3,2.5,3,3,3.5,3.5,3,2,1,1,1,1,1,2,2,1,2,1,2,2,1,1,1,1,1,2,2,1,2,2,2,2,2,2,1,2,2,2,1,2,1,1.5,2,1,2,1,1,2,1,2,2,2,2,2,2,2,1,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,1,1.5,2,1,1,3,2,2,2,2,1,2,2,2,1,2,2,3,2,2,2,1,2,1,2,2,2,2,2,1,2,2,2,2.5,2,2,2,2,1,1,4,1,2,2,2,2,2,3,2,2,2,2],[836,1167,796,852,797,1122,1104,1177,941,1146,909,1289,871,1020,1022,1134,844,795,588,1356,1118,1329,1240,1601,901,1088,963,1119,1380,1248,1039,1152,1380,1116,1039,1418,1082,1472,1146,760,1304,1207,1056,1043,1587,1120,1580,1955,1656,1477,1188,1590,1463,1714,1185,1406,1943,1172,1152,1851,1215,1130,1603,1479,1420,1280,1586,1362,2162,1266,1715,1820,936,1665,1511,1590,1596,1341,2136,1616,1478,1287,1277,1448,2235,2093,1193,2163,1269,1473,958,2508,1305,1591,1326,1843,1921,2790,1541,1018,1713,1672,1380,975,2372,1446,1284,3009,3612,2056,1993,1857,1126,2213,2494,1843,1520,2800,2309,2367,3516,2536,1914,1690,2725,2354,1842,2185,1801,1961,3134,1915,1873,1638,2734,2110,3164,3599,2054,1830,1627,3440,2846,2359,2052,3433,3615,3714,2687,2724,3440,3508,2462,2900,3705,3527,2325,4878,795,1099,840,800,746,1067,1316,1337,868,924,610,1516,1220,722,1643,722,1080,1039,1051,967,1098,1050,1110,888,1120,1080,957,952,1211,1264,1080,1266,994,1202,1039,722,1448,1188,1183,1320,1117,1364,1310,1006,1104,810,1123,904,1156,1321,1392,1439,1159,1671,1740,1265,1007,1716,1685,1829,1555,1120,1137,1174,1393,1415,2126,1289,1799,1308,1953,723,1376,948,1578,1317,1360,1360,1522,1751,1465,1605,1475,1216,1315,1567,1776,2187,1291,1129,1453,1503,2491,1269,1718,1176,1456,1498,1574,2085,2170,1595,1567,2943,1253,1768,1980,2030,1531,1750,1653,2056,2494,1450,2169,1440,1527,1401,1411,2990,1533,1284,2307,1329,1910,1981,1829,1665,3072,2205,1449,1258,2575,539,2208,1108,1595,2159,2295,1838,1900,1718,3389,2190,3260,2016,2607,2724,3746,3969,3192,2829,3928,3577,1247,2581,2068,2129,3992,3397,3881,3167,1598,1929,3070,2272,2791,3117,2544,3984,2222,3838,3059,2846,2484,1624,840,484,970,623,932,796,834,834,924,795,1250,984,1013,1012,795,918,1082,964,1404,625,888,1120,1331,1014,1448,966,779,836,1100,1174,1207,1995,804,958,1366,901,696,1080,1104,972,1390,1354,795,780,1587,1209,1139,1690,1245,1416,1300,1120,1590,1407,1516,1057,1646,1676,1370,1370,1351,1152,1452,990,1162,1182,1112,1100,1280,1280,1039,1159,1917,1520,1204,1120,1436,1451,1638,1000,1152,1154,1353,1329,1356,1505,1009,1144,930,1766,1940,1776,1258,1872,1112,1856,1939,998,1758,2142,950,1739,1516,988,1555,1212,1871,1302,756,2026,1375,1250,1058,1187,1324,1936,2382,1427,1678,1798,2652,1816,3076,1844,1306,2447,1176,1182,1160,1424,1574,1830,1724,1255,1718,2175,1904,1808,2711,1713,1457,2724,1847,1468,2550,1928,1922,1343,1510,960,1559,1624,2992,2109,1524,1248,1876,2489,1851,1829,2218,1394,1410,3468,2346,2347,1659,2442,2590,2155,1673,1810,2789,1606,3499,2166,1119,1871,1800,1683,1625,2752,1596,2716,1179,2724,1639,3281,1697,1993,2085,2548,1744,2730,1939,2376,1788,1691,2002,4303,4246,2274,2962,3056,2503,3198,3332,1905,1320,1873,3157,3037,3741,2660,3357,2896,2025,3788,3670,1166,1000,838,904,1032,904,1080,990,900,861,906,1011,1089,832,800,1292,810,1064,911,846,1320,1410,1115,1169,1164,1341,1219,1127,1272,1253,1120,1118,1890,1260,1400,1264,1060,1132,1466,1092,1628,960,1075,1428,1358,2475,1410,1711,1483,1140,1549,1410,1240,1712,1580,1669,1029,1103,2161,1650,1320,1200,1170,1199,1695,1157,1410,1174,1593,1093,1770,1436,1124,1139,1638,1328,1273,1082,1578,796,1386,1452,1513,1232,1578,1736,1498,1473,1150,1127,1144,972,2306,1479,1040,1430,1800,1953,1120,1232,984,1462,2329,1351,1284,1376,1300,1566,1115,1032,1419,1261,1637,1776,1338,1257,2254,1441,1991,2126,1094,1462,2258,1074,2111,1686,1915,2367,1962,1406,1789,1876,1235,2504,2029,1676,1367,1899,1636,1828,1771,1438,1451,1520,1506,2605,1196,1621,1811,1540,2647,2750,1910,1846,1543,2494,1650,2214,2280,1443,1582,1857,1735,2096,1720,2160,1382,1282,1721,1328,1919,1982,1144,1623,1457,2555,1577,2592,1401,2048,1502,1327,1800,2169,2457,2264,2004,2212,3134,1360,1951,1276,2962,1888,2155,1744,1548,1322,2109,2484,2258,2212,1616,2372,2606,3163,2877,2960,1704,2172,2100,1795,1924,2295,2577,2616,1727,1485,1655,3179,3479,2049,3042,2875,3566,2199,2242,1304,2334,2278,1493,1944,3913,3151,2787,2824,3261,2053,2379,2480,1704,2418,3282,4091,2806,3173,3380,1348,4090,1252,3229,3863,3901,2346,2356,3220,3579,3464,3885,3782,4400,1512,611,876,933,864,1011,1158,1092,956,1139,1058,1040,1354,1051,682,1161,1004,1229,1249,1161,1010,1005,1462,1269,1188,1570,1093,962,1089,1127,1309,970,1144,1000,1065,1206,1285,1543,884,1019,1392,924,1217,1670,1302,1488,1373,1381,1265,881,1917,1608,1344,1202,1104,1057,1859,1232,1638,1177,1582,904,1340,1204,1477,1497,960,1194,1428,1039,1529,1892,1887,1294,1638,1677,1073,1231,1175,1416,936,1358,1609,1968,1089,1296,1189,795,1371,1310,1262,1740,1517,1450,1416,888,1882,1302,1418,1462,1319,1770,1627,1665,1040,960,1197,1456,1450,1358,1329,1715,1262,2280,1477,1216,1685,1362],["Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Multi_Family","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Multi_Family","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Multi_Family","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Condo","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Multi_Family","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Condo","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential","Residential"],[59222,68212,68880,69307,81900,89921,90895,91002,94905,98937,100309,106250,106852,107502,108750,110700,113263,116250,120000,121630,122000,122682,123000,124100,125000,126640,127281,129000,131200,132000,133000,134555,136500,138750,141000,146250,147308,148750,149593,150000,152000,154000,156896,161250,161500,164000,165000,166357,166357,168000,170000,173000,174250,174313,178480,178760,179580,181000,181872,182587,182716,182750,183200,188741,189000,192067,194000,194818,195000,198000,199500,200000,200000,206000,208000,212864,221000,221000,223058,227887,231477,234697,235000,236000,236685,237800,240122,242638,244000,244500,244960,245918,250000,250000,250134,254200,254200,258000,260000,260014,263500,265000,265000,271742,273750,275086,280908,280987,282400,285000,287417,291000,292024,297000,297000,298000,299000,304037,311000,315537,320000,320000,328360,334150,335750,335750,339500,344250,346210,347029,347650,351300,352000,370000,370500,372000,375000,381300,381942,387731,391000,394470,395000,400186,415000,425000,430000,445000,460000,461000,489332,510000,539000,585000,600000,606238,660000,830000,69000,70000,71000,78000,78400,80000,89000,90000,90000,92000,93675,97750,98000,98000,99000,100000,106716,111000,111000,114800,120108,123225,123750,125000,125000,126000,129000,134000,135000,135500,140000,140000,142500,143500,145000,145000,145000,145000,146000,148500,149000,150000,150000,152000,156000,156000,156000,157788,161653,161829,165000,168000,169000,175000,176250,179000,180000,180400,182000,184500,185000,189000,194000,195000,200000,201000,202500,205000,205000,205000,205000,207000,210000,211500,215000,215000,215500,222381,225000,225000,225000,228000,229665,230000,230000,230000,234000,235000,236250,240000,242000,245000,245000,245000,250000,250000,250000,250000,255000,256054,257729,260000,261000,261800,264469,265000,270000,270000,270000,270000,275000,275000,280000,286013,292000,292000,293993,294000,296769,297500,300000,300000,300000,300000,300500,305000,306500,312500,315000,319789,330000,330000,331000,334000,336000,339000,339000,345000,350000,356000,361745,361948,370000,380000,385000,399000,402000,406026,420000,425000,425000,433500,436746,438700,445000,450000,460000,460000,460000,465000,471750,480000,484000,485000,495000,500500,504000,541000,560000,572500,582000,613401,614000,680000,699000,839000,40000,48000,61500,62050,65000,65000,68000,68000,77000,82732,84000,84675,85000,90000,90000,91000,95000,97500,100000,100000,101000,102750,112500,113000,114000,114000,114750,115000,115000,116100,119250,120000,120000,120000,120108,121500,121725,122000,123000,125000,125573,126714,126960,127000,127500,130000,133105,136500,139500,140000,140800,145000,147000,149600,150000,150000,150000,155000,155435,155500,158000,158000,160000,160000,164000,164000,165000,167000,167293,167293,168000,170000,170000,170000,174000,178000,180000,180000,180000,182000,188325,191500,192000,192700,195000,197654,198000,200345,203000,207000,208000,210000,212000,213675,213697,215000,215000,215100,217500,218000,220000,221000,222900,223139,225500,228327,230000,230000,230522,231200,232000,232500,233641,234000,234500,235000,236000,236073,238000,238861,239700,240000,240000,241000,245000,246000,247234,247480,249862,251000,252155,254172,258000,260000,261000,261000,261000,262500,266000,266000,270000,274425,274500,275336,277980,280000,284686,284893,285000,285000,285000,289000,295000,296000,296056,297359,299940,304000,305000,307000,311328,313138,316630,320000,320000,325000,328578,331000,331500,340000,344755,345746,351000,353767,355000,356035,360000,360552,362305,365000,367554,368500,370000,371086,378000,383000,388000,395100,400000,400000,408431,413000,416767,420000,423000,423000,427500,430922,445000,450000,452000,470000,471000,475000,484500,487500,488750,500000,506688,512000,520000,528000,579093,636000,668365,676200,677048,691659,760000,30000,30000,55422,63000,65000,65000,65000,66500,71000,75000,77000,85000,95625,96140,104250,105000,108000,109000,115000,115000,115500,115620,116000,122000,122500,123000,124000,124000,124413,125000,130000,131750,137721,137760,138000,140000,145000,145000,150000,150000,151000,155000,155800,156142,158000,159900,160000,161500,161600,162000,165000,165000,167293,168000,168000,168750,168750,170000,170250,173000,175000,176095,176250,178000,179000,180000,180000,180000,181000,182000,182587,185074,185833,186785,187000,188335,190000,190000,190000,190000,191250,193000,193500,194818,195000,195000,195000,195000,198000,199900,200000,201000,204918,205000,205000,205878,207000,207744,209000,210000,210944,212500,213750,215000,215000,215000,216033,220000,220000,220000,220000,220000,220702,221250,222000,222500,222750,225000,225000,228750,229000,230095,232500,233000,233500,239000,240000,240000,240971,242000,243450,243500,246544,246750,247000,247000,249000,249000,250000,250000,250000,252000,255000,255000,255000,257200,260000,260000,263500,266510,267750,270000,271000,272700,275000,276000,276500,278000,279000,280000,280000,285000,288000,289000,290000,290000,293996,294000,294173,295000,298000,298000,299000,300000,300000,300000,300567,303000,305000,306000,310000,310000,310000,311518,312000,313000,315000,315000,315000,315000,315000,320000,322000,325000,325500,326951,328370,330000,330000,331200,332000,334000,335000,341000,346375,347225,349000,350000,350000,350000,350000,351000,356200,360000,367463,375000,380000,380578,386222,389000,390000,395500,396000,397000,400000,400000,412500,413500,415000,420454,425000,425000,433500,438000,441000,445000,446000,450000,455000,460000,475000,490000,493000,508000,511000,525000,533000,545000,560000,575000,575000,598695,600000,600000,600000,600000,610000,622500,680000,879000,884790,56950,60000,61000,62000,68566,70000,80000,85500,92000,93600,95000,97750,104000,105000,107666,109000,110000,110000,112500,114800,116000,119000,121500,122000,123675,126854,127059,128687,129500,130000,131750,132000,134000,134000,138000,142000,143012,145846,147000,148750,150000,150454,151087,157296,157500,160000,160000,161250,164000,165000,165000,165750,166000,169000,170000,170000,170000,170000,170725,171750,172000,173056,174000,174250,176850,179500,185000,188000,188700,189000,189000,189836,190000,191250,191675,195500,198000,200000,200000,200000,200100,201528,204750,205000,205000,205900,207000,207973,208250,208318,209347,211500,212000,213000,216000,216021,219000,219794,220000,220000,220000,220000,223000,224000,224000,224252,224500,225000,228000,229027,229500,230000,230000,232425,234000,235000,235301,235738],[38.631913,38.478902,38.618305,38.616835,38.51947,38.662595,38.681659,38.535092,38.621188,38.700909,38.637663,38.470746,38.618698,38.482215,38.672914,38.700051,38.689591,38.679776,38.612099,38.689999,38.707851,38.468173,38.702792,38.628631,38.701499,38.70974,38.537526,38.476472,38.558423,38.472122,38.423251,38.691161,38.566663,38.713182,38.423251,38.48742,38.658246,38.479553,38.49857,38.58514,38.658812,38.493955,38.41653,38.72027,38.699251,38.613765,38.450543,38.489405,38.636748,38.499954,38.415518,38.473814,38.477553,38.474853,38.465184,38.287789,38.665724,38.547011,38.662105,38.4473,38.714609,38.260443,38.664186,38.251808,38.459041,38.560767,38.422811,38.711279,38.48009,38.44004,38.44076,38.687742,38.664468,38.631481,38.653439,38.454349,38.427818,38.67307,38.435436,38.400676,38.491399,38.593699,38.702855,38.618457,38.463355,38.547991,38.693818,38.400974,38.478198,38.626671,38.502519,38.443832,38.665395,38.444909,38.637028,38.38692,38.653917,38.42568,38.656251,38.53151,38.553867,38.648879,38.708315,38.523947,38.472976,38.502194,38.75485,38.474099,38.559505,38.410992,38.4439,38.391538,38.556098,38.5703,38.442031,38.40154,38.62869,38.658182,38.442352,38.555993,38.545128,38.528575,38.550848,38.71147,38.398609,38.403492,38.602416,38.68479,38.41333,38.448507,38.380635,38.46534,38.691299,38.4772,38.4874,38.35062,38.4019,38.677126,38.509819,38.709873,38.58355,38.408351,38.945357,38.450829,38.487885,38.385638,38.550617,38.420338,38.646273,38.38253,38.406421,38.38253,38.655167,38.670947,38.672761,38.666807,38.591618,38.669931,38.680923,38.554967,38.40573,38.624678,38.518044,38.515125,38.623571,38.622953,38.518373,38.51055,38.53942,38.492287,38.621998,38.423251,38.588672,38.423251,38.241514,38.52712,38.67895,38.682279,38.587156,38.518942,38.636565,38.650445,38.514665,38.717976,38.66654,38.637678,38.658478,38.61779,38.623817,38.270617,38.662785,38.631056,38.423251,38.532727,38.488623,38.488611,38.692915,38.487444,38.473288,38.482876,38.484834,38.420138,38.693724,38.609982,38.41875,38.67273,38.720653,38.541965,38.715346,38.448288,38.69951,38.591477,38.457654,38.461283,38.710889,38.417649,38.417182,38.592383,38.435471,38.666564,38.718693,38.543697,38.704407,38.694052,38.879192,38.461296,38.655887,38.74458,38.443253,38.536741,38.69437,38.739774,38.696489,38.710388,38.626582,38.513066,38.624762,38.606603,38.419214,38.55821,38.702893,39.008159,38.665644,38.390557,38.672495,38.661658,38.534596,38.6457,38.43742,38.699489,38.459711,38.562296,38.676658,38.669882,38.692199,38.725283,38.710221,38.682358,38.45967,38.409634,38.705849,38.879084,38.482704,38.717042,38.676937,38.671807,38.665704,38.647961,38.435288,38.411522,38.404934,38.660322,38.633028,38.752399,38.664552,38.776327,38.65783,38.864864,38.625289,38.700553,38.272942,38.694559,38.677454,38.628732,38.772771,38.668692,38.866409,38.447353,38.849924,38.667834,38.387014,38.542727,38.573488,38.563805,38.652002,38.279581,38.738141,38.782094,38.487409,38.591822,38.405224,38.778691,38.405527,38.664225,38.805749,38.390465,38.271646,38.527502,38.512602,38.650221,38.857635,38.679136,38.582604,38.676306,38.646374,38.668239,38.403609,38.665696,38.677225,38.801637,38.602754,38.787877,38.398488,38.770153,38.891935,38.628459,38.408841,38.47643,38.602461,38.735373,38.742118,38.64167,38.563244,38.813337,38.673678,38.582279,38.620685,38.546798,38.532718,38.638797,38.539447,38.539447,38.658739,38.669104,38.637337,38.53728,38.497237,38.484274,38.559144,38.630151,38.637704,38.663282,38.617718,38.544627,38.675893,38.622243,38.68972,38.623738,38.53361,38.659414,38.463929,38.71607,38.732429,38.470093,38.656131,38.490704,38.53105,38.647523,38.470187,38.454949,38.613103,38.24227,38.50372,38.598321,38.617173,38.705834,38.557045,38.749723,38.49069,38.699269,38.520941,38.691104,38.628563,38.71865,38.47807,38.484896,38.478502,38.479083,38.534508,38.795529,38.489759,38.457157,38.646677,38.646677,38.70166,38.697898,38.45356,38.734136,38.720868,38.687659,38.42465,38.283085,38.715781,38.715781,38.52774,38.695677,38.620687,38.564,38.260467,38.658734,38.447585,38.55992,38.466499,38.637396,38.72748,38.747878,38.657811,38.706152,38.544368,38.645689,38.681541,38.46452,38.581471,38.687943,38.468639,38.413947,38.698154,38.460492,38.423963,38.619675,38.573844,38.746794,38.756149,38.658466,38.48403,38.417026,38.398245,38.705753,38.282001,38.534827,38.62478,38.47547,38.657789,38.72286,38.49026,38.644406,38.523828,38.727657,38.48797,38.462981,38.603686,38.679626,38.665296,38.277177,38.725079,38.456939,38.63437,38.43461,38.46179,38.604969,38.489215,38.687021,38.683674,38.675506,38.691829,38.710221,38.451353,38.931671,38.416916,38.676172,38.681194,38.664347,38.551046,38.671995,38.395256,38.380089,38.805036,38.476932,38.666074,38.285611,38.582818,38.715853,38.786746,38.939802,38.64913,38.673285,38.473162,38.432848,38.579,38.464994,38.49254,38.847396,38.57727,38.773094,38.68237,38.47316,38.468185,38.439565,38.707705,38.709299,38.638764,38.406758,38.557293,38.606906,38.664765,38.475433,38.388129,38.2535,38.287785,38.68318,38.53805,38.672966,38.67342,38.553596,38.791617,38.796121,38.837006,38.733155,38.390328,38.381102,38.541735,38.551083,38.574894,38.69288,38.727649,38.837455,38.622359,38.675519,38.66695,38.687072,38.571943,38.82553,38.411258,38.399436,38.628955,38.73988,38.677015,38.693041,38.409689,38.647598,38.777585,38.69435,38.862708,38.861615,38.796683,38.629299,38.416809,38.684459,38.63558,38.723545,38.737452,38.413535,38.779435,38.715322,38.687172,38.471646,38.672642,38.608085,38.636833,38.544162,38.493504,38.636877,38.521202,38.459002,38.6238,38.466938,38.62391,38.517029,38.679598,38.520319,38.635232,38.610852,38.658812,38.563402,38.660173,38.59368,38.492177,38.491991,38.481454,38.655554,38.69043,38.686061,38.482717,38.477297,38.659016,38.646541,38.623045,38.487297,38.619012,38.522015,38.47955,38.472117,38.559641,38.493484,38.68747,38.695863,38.554927,38.474854,38.465271,38.689239,38.70968,38.536751,38.282047,38.487864,38.467487,38.434075,38.677003,38.449153,38.71846,38.544374,38.71641,38.479343,38.466781,38.77491,38.553275,38.68271,38.70799,38.448452,38.60868,38.646206,38.734136,38.44617,38.68279,38.72446,38.48291,38.453839,38.565322,38.476048,38.609864,38.431239,38.659434,38.573917,38.727609,38.478239,38.589925,38.470494,39.020808,38.693071,38.676437,38.690504,38.611055,38.532725,38.618019,38.66424,38.622634,38.42139,38.724083,38.678758,38.641727,38.47723,38.71174,38.681952,38.640807,38.668433,38.793533,38.449651,38.410561,38.691215,38.736392,38.688255,38.593598,38.557433,38.556818,38.698058,38.404888,38.63173,38.585291,38.423913,38.3052,38.421713,38.638882,38.650729,38.459524,38.443184,38.798028,38.639891,38.59675,38.38751,38.671556,38.706209,38.420637,38.443305,38.625932,38.455753,38.674226,38.720767,38.70884,38.631139,38.657267,38.708966,38.422241,38.428852,38.627698,38.804993,38.555633,38.442845,38.599449,38.776649,38.675594,38.679409,38.89918,38.679191,38.387708,38.88156,38.813546,38.770835,38.695801,38.397455,38.663728,38.844116,38.258976,38.667332,38.66266,38.691393,38.397923,38.417191,38.391085,38.567865,38.704554,38.644927,38.729993,38.450548,38.825096,38.446286,38.422221,38.556844,38.567795,38.905927,38.404505,38.800539,38.38912,38.715493,38.865017,38.618369,38.651617,38.76349,38.490408,38.844144,38.529181,38.668289,38.775872,38.711927,38.606569,38.815493,38.525115,38.64977,38.82273,38.772821,38.771917,38.290119,38.861864,38.580545,38.56803,38.6354,38.674864,38.667703,38.66841,38.807816,38.79218,38.386239,38.709513,38.853869,38.792461,38.762153,38.483212,38.686067,38.733985,38.792493,38.778561,38.247659,38.429139,38.629929,38.867125,38.5357,38.737872,38.527384,38.405571,38.904869,38.656299,38.808581,38.551611,38.634111,38.935579,38.579326,38.669805,38.860007,38.804773,38.66051,38.506371,38.673882,38.621566,38.750577,38.680092,38.690867,38.84255,38.681778,38.676131,38.780051,38.650735,38.664066,38.588936,38.865246,38.568438,38.703962,38.45326,38.798448,38.772672,38.732096,38.781134,38.78861,38.6478,38.682961,38.706692,38.415298,38.488628,38.542419,38.471139,38.670467,38.539213,38.643978,38.618716,38.64472,38.627147,38.520469,38.488238,38.628842,38.484374,38.679279,38.578675,38.511893,38.647398,38.669587,38.480126,38.479593,38.465551,38.681393,38.528479,38.47709,38.532359,38.631925,38.546091,38.507339,38.466388,38.52049,38.506382,38.695589,38.462376,38.593049,38.88415,38.706175,38.603593,38.477563,38.563084,38.54117,38.46654,38.672567,38.46616,38.725873,38.473775,38.502034,38.685361,38.717738,38.462821,38.556178,38.584526,38.467012,38.681554,38.634292,38.893168,38.795529,38.490606,38.475853,38.490822,38.480859,38.622794,38.502254,38.433919,38.62457,38.44574,38.45073,38.667254,38.88417,38.634335,38.530144,38.66745,38.699714,38.649258,38.687006,38.477568,38.46734,38.700717,38.651386,38.42442,38.452075,38.569943,38.68197,38.438818,38.68607,38.555781,38.623372,38.424421,38.612694,38.737882,38.694279,38.259708,38.444,38.722959,38.467836,38.451398,38.508217,38.715423,38.390893,38.424497,38.793152,38.665104,38.289544,38.69674,38.631026,38.629468,38.70355,38.69757,38.703056,38.389756,38.897814,38.467936,38.445342,38.417382,38.457679,38.499893,38.708824,38.417,38.655245],[-121.434879,-121.431028,-121.443839,-121.439146,-121.435768,-121.327813,-121.351705,-121.481367,-121.270555,-121.442979,-121.45152,-121.458918,-121.435833,-121.492603,-121.35934,-121.351278,-121.452239,-121.314089,-121.469095,-121.46322,-121.320707,-121.444071,-121.38221,-121.488097,-121.37622,-121.37377,-121.478315,-121.501711,-121.327948,-121.404199,-121.444489,-121.37192,-121.332644,-121.411227,-121.444489,-121.462459,-121.375469,-121.463317,-121.420925,-121.403736,-121.542345,-121.48966,-121.379653,-121.331555,-121.371414,-121.488694,-121.432538,-121.452811,-121.422159,-121.454469,-121.370527,-121.4,-121.419463,-121.406326,-121.434925,-121.294715,-121.358576,-121.366217,-121.313945,-121.435218,-121.347887,-121.297864,-121.217511,-121.302493,-121.424644,-121.377471,-121.423285,-121.393449,-121.415102,-121.421012,-121.385792,-121.17104,-121.32683,-121.50188,-121.535169,-121.439239,-121.424026,-121.506373,-121.394536,-121.38101,-121.443547,-121.31089,-121.31308,-121.509439,-121.358936,-121.280483,-121.441153,-121.448424,-121.412911,-121.52597,-121.420769,-121.382087,-121.293288,-121.412345,-121.312963,-121.447349,-121.34218,-121.438062,-121.547572,-121.421089,-121.219141,-121.544023,-120.603872,-121.484946,-121.318633,-121.490795,-120.60476,-121.490711,-121.364839,-121.479043,-121.37255,-121.442596,-121.490787,-121.315735,-121.410873,-121.447649,-121.261669,-121.549521,-121.389675,-121.340352,-121.224922,-121.2286,-121.370224,-121.216214,-121.450148,-121.430224,-121.542965,-121.149199,-121.404999,-121.421346,-121.425538,-121.457519,-121.081752,-121.5215,-121.075129,-121.228349,-121.420388,-121.500519,-121.519661,-121.339472,-121.487289,-121.423925,-120.908822,-121.349928,-121.545947,-121.422616,-121.23526,-121.363757,-121.175322,-121.428007,-121.422081,-121.428038,-121.090178,-121.097727,-121.050378,-121.06483,-121.370626,-121.05958,-121.313945,-121.468046,-121.369832,-121.439203,-121.443555,-121.480416,-121.454884,-121.450142,-121.411779,-121.414768,-121.446894,-121.100032,-121.442238,-121.444489,-121.373916,-121.444489,-121.312199,-121.435348,-121.379406,-121.352817,-121.295778,-121.430158,-121.460383,-121.374861,-121.480411,-121.407684,-121.378298,-121.452476,-121.450409,-121.436765,-121.477827,-121.299205,-121.276272,-121.48508,-121.444489,-121.470783,-121.410582,-121.412808,-121.367497,-121.491366,-121.3963,-121.405912,-121.449316,-121.412179,-121.307169,-121.419263,-121.370019,-121.359645,-121.302241,-121.452132,-121.388163,-121.420719,-121.359989,-121.31534,-121.431381,-121.434322,-121.358876,-121.420294,-121.397231,-121.318669,-121.441173,-121.325717,-121.303619,-121.366683,-121.36113,-120.995589,-121.309477,-121.390858,-121.446119,-120.794254,-121.431992,-121.42115,-120.996602,-120.860243,-121.328555,-121.261096,-121.52151,-121.451909,-121.522775,-121.394147,-121.348533,-121.355022,-121.454949,-121.03623,-121.259969,-121.449805,-121.515251,-121.540633,-121.493121,-121.1197,-121.372876,-121.361828,-121.384283,-121.467489,-121.528128,-121.213533,-121.250975,-121.297953,-121.341651,-121.272876,-121.360461,-121.410787,-121.334701,-121.298586,-121.500433,-121.35468,-121.529244,-121.498274,-121.529096,-121.543162,-121.375703,-121.481406,-121.352405,-121.230101,-121.526755,-121.330328,-121.255937,-121.284514,-121.456842,-121.313988,-121.260286,-121.452223,-121.289148,-120.848157,-121.494791,-121.261149,-121.364877,-121.54549,-121.308485,-121.434969,-121.275729,-121.168578,-121.440967,-121.442449,-121.282809,-121.436395,-121.129504,-121.300828,-120.784145,-121.297133,-121.461413,-121.478644,-121.479275,-121.204292,-121.431746,-121.007173,-121.280931,-121.443479,-121.286848,-121.233492,-121.087233,-121.551704,-121.311375,-121.034329,-121.47576,-121.09954,-121.353658,-121.064437,-121.335541,-121.549437,-121.519687,-121.278798,-121.329326,-120.816676,-121.473424,-121.300039,-121.08434,-121.055078,-121.198039,-121.309243,-121.330979,-121.227072,-121.359909,-121.262099,-121.446876,-121.133348,-121.357471,-121.401482,-121.460539,-121.460038,-121.46747,-121.435049,-121.450858,-121.450858,-121.333561,-121.359008,-121.432835,-121.463531,-121.424187,-121.488851,-121.368387,-121.442789,-121.453946,-121.359631,-121.440089,-121.35796,-121.2963,-121.457863,-121.378399,-121.41305,-121.469308,-121.45408,-121.438667,-121.364468,-121.288069,-121.468347,-121.377265,-121.410176,-121.479574,-121.523217,-121.448149,-121.440578,-121.444085,-121.31032,-121.490657,-121.39161,-121.482541,-121.43919,-121.37167,-121.27008,-121.382619,-121.376334,-121.459355,-121.451832,-121.328297,-121.407763,-121.48114,-121.486948,-121.403517,-121.400702,-121.467907,-121.328819,-121.474754,-121.433065,-121.437573,-121.437573,-121.323249,-121.377687,-121.435959,-121.299639,-121.309855,-121.4633,-121.430137,-121.302071,-121.298519,-121.298519,-121.433669,-121.36022,-121.482619,-121.320023,-121.302636,-121.357196,-121.426627,-121.352539,-121.381119,-121.300055,-121.256537,-121.311279,-121.465327,-121.325399,-121.369979,-121.452766,-121.355616,-121.427606,-121.38839,-121.328883,-121.403265,-121.408276,-121.298375,-121.373379,-121.428875,-121.496903,-121.462839,-121.29971,-121.306479,-121.460661,-121.507641,-121.416821,-121.380615,-121.388917,-121.295902,-121.412545,-121.523474,-121.380055,-121.354994,-121.358939,-121.550527,-121.549049,-121.481139,-121.391028,-121.530229,-121.408288,-121.277844,-121.142609,-121.531993,-121.303747,-121.387698,-121.362965,-121.510779,-121.429316,-121.445371,-121.54255,-121.419546,-121.463151,-121.435204,-121.510987,-121.249033,-121.341707,-121.358776,-121.097862,-121.407554,-121.509761,-121.537351,-121.076529,-121.239411,-121.324339,-121.438249,-121.428186,-121.293608,-121.378349,-121.509743,-121.293063,-121.489096,-121.317095,-121.209957,-121.054575,-121.310667,-120.879176,-121.491085,-121.449237,-121.292627,-121.386962,-121.463316,-121.259586,-121.285591,-121.365905,-121.539147,-121.403893,-121.375694,-121.436606,-121.354153,-121.353056,-121.531827,-121.431669,-121.217611,-121.54132,-121.445006,-121.372584,-121.43117,-121.31812,-121.289903,-121.53484,-121.5047,-121.502748,-121.508542,-121.459483,-121.286147,-121.319963,-121.232024,-120.748039,-121.448022,-121.42901,-121.480098,-121.237476,-121.435806,-121.073551,-121.385656,-121.289337,-121.457582,-121.015862,-121.120729,-121.004729,-121.492106,-121.254698,-121.431348,-121.444041,-121.529269,-121.248929,-121.034083,-121.23294,-121.446059,-121.077801,-121.2036,-121.177259,-121.162092,-121.26869,-121.342555,-121.249021,-121.240628,-121.145935,-121.353639,-121.216025,-120.910963,-121.188211,-121.146676,-121.314787,-121.463933,-121.435158,-121.380343,-121.449651,-121.44164,-121.460652,-121.475304,-121.444948,-121.428146,-121.428794,-121.439872,-121.455631,-121.439208,-121.513809,-121.356035,-121.504727,-121.460098,-121.273278,-121.542345,-121.327747,-121.440216,-121.316054,-121.503392,-121.477636,-121.446644,-121.464275,-121.361035,-121.369949,-121.499683,-121.411513,-121.370457,-121.441139,-121.486279,-121.44295,-121.415329,-121.438713,-121.410867,-121.459589,-121.32316,-121.42035,-121.349234,-121.300814,-121.35521,-121.404726,-121.40426,-121.267737,-121.382328,-121.359154,-121.295812,-121.402476,-121.377055,-121.432623,-121.354454,-121.428272,-121.370862,-121.370874,-121.306239,-121.372553,-121.450955,-120.597599,-121.346218,-121.501697,-121.302979,-121.428536,-121.27849,-121.442767,-121.299639,-121.427824,-121.453509,-121.292829,-121.491509,-121.357919,-121.374251,-121.494961,-121.492304,-121.44001,-121.455236,-121.316916,-121.226494,-121.446326,-121.299059,-121.454162,-120.821518,-121.332365,-121.279165,-120.996245,-121.369964,-121.469078,-121.510215,-121.303675,-121.330846,-121.411339,-121.3584,-120.844118,-121.412703,-121.492568,-121.342675,-121.505009,-121.533522,-121.503471,-121.289685,-121.414704,-121.404327,-120.994949,-121.2664,-120.810235,-121.403637,-121.47034,-121.490669,-121.294893,-121.443998,-121.335286,-121.406824,-121.439115,-121.4033,-121.345191,-121.531883,-121.466483,-121.3501,-121.364388,-121.235364,-121.537603,-121.312716,-121.370276,-121.520916,-121.369509,-121.375798,-121.435296,-121.271517,-121.349273,-121.525497,-121.376678,-121.359559,-121.501879,-121.310352,-121.32467,-121.458022,-121.415628,-121.369698,-121.293609,-121.350691,-121.373272,-121.400305,-121.339589,-121.515878,-121.219107,-121.322514,-121.537622,-121.436522,-121.301343,-120.809254,-121.366996,-121.079216,-121.468391,-121.525833,-121.274806,-121.321266,-121.528276,-121.316858,-121.305215,-121.450219,-121.473897,-121.347231,-121.410699,-121.354753,-121.43054,-120.802458,-121.363002,-121.198432,-121.400817,-121.375799,-121.490769,-121.410703,-120.975169,-121.346938,-121.260979,-121.434389,-121.26293,-121.32302,-121.326187,-121.131674,-121.275881,-121.547664,-121.274174,-121.224755,-121.192316,-121.298864,-121.343608,-121.368424,-121.262908,-121.518689,-121.53448,-121.26424,-121.364821,-121.304439,-121.286023,-121.267478,-121.279016,-121.309966,-121.53499,-121.4958,-121.209456,-121.494639,-121.270008,-121.28595,-121.448159,-121.359357,-121.271742,-121.275711,-121.283451,-121.54019,-121.073413,-121.236766,-121.331899,-121.362008,-121.515129,-121.423444,-121.323086,-121.319085,-121.2249,-121.249025,-121.233531,-121.445186,-121.32075,-121.079783,-121.32785,-121.504437,-121.353376,-121.079018,-121.44252,-120.999007,-121.310946,-121.341195,-121.163689,-121.514456,-121.105077,-121.370882,-121.232768,-121.036467,-120.693641,-120.8754,-121.035838,-121.038931,-121.378718,-121.258628,-121.056735,-121.373606,-121.094869,-121.457854,-121.1871,-121.32573,-121.344054,-121.220232,-121.219142,-121.222801,-121.339495,-121.0309,-121.033253,-121.058869,-121.194858,-121.387759,-121.359904,-121.432255,-121.359799,-121.46393,-121.449562,-121.466327,-121.452228,-121.500799,-121.458606,-121.472561,-121.446127,-121.463157,-121.376615,-121.409951,-121.457676,-121.432914,-121.379879,-121.487869,-121.48434,-121.42661,-120.996713,-121.411806,-121.410569,-121.41167,-121.427775,-121.457745,-121.416267,-121.458861,-121.411383,-121.483574,-121.444133,-121.426556,-121.30304,-121.270277,-121.379776,-121.417011,-121.384382,-121.535579,-121.458129,-121.419029,-121.356754,-121.448283,-121.35856,-121.493777,-121.456027,-121.376938,-121.308322,-121.433135,-121.476256,-121.534609,-121.359969,-121.312934,-121.485106,-121.305398,-121.328819,-121.410173,-121.477039,-121.401643,-121.539745,-121.499173,-121.451444,-121.422347,-121.486913,-121.3725,-121.427528,-121.240708,-121.270222,-121.486098,-121.43749,-121.2364,-121.311635,-121.465308,-121.254319,-121.492574,-121.419843,-121.3133,-121.45042,-121.440357,-121.366461,-121.527539,-121.500025,-121.37443,-121.342369,-121.485331,-121.347665,-121.443915,-121.456669,-121.308142,-121.373395,-121.311616,-121.370993,-121.347115,-121.410366,-121.366614,-121.411207,-121.246743,-121.437821,-121.426595,-121.290025,-121.315901,-121.284607,-121.350519,-121.501879,-121.376445,-121.375103,-120.995739,-121.235221,-121.446246,-121.324691,-121.445477,-121.441504,-121.484325,-121.35962,-121.45889,-121.256803,-121.397424,-121.075915]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>beds<\/th>\n      <th>baths<\/th>\n      <th>sqft<\/th>\n      <th>type<\/th>\n      <th>price<\/th>\n      <th>latitude<\/th>\n      <th>longitude<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[0,1,2,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### Step-by-step example

(Pretend we only have 8 observations.) Randomly select a set of training data (blue rows) from the derivation data.

![](index_files/figure-html/unnamed-chunk-37-1.png)&lt;!-- --&gt;

---

### Step-by-step example

Use the training data to develop one prediction rule for stepwise model selection and glmnet. 

![](index_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;

---

### Step-by-step example

Apply each prediction rule to the testing data, creating a set of predictions for each. 

![](index_files/figure-html/unnamed-chunk-39-1.png)&lt;!-- --&gt;

---

### Step-by-step example

Evaluate each set of predictions (just one shown here)

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; predicted &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; observed &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Error &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Squared Error &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; -0.63 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -0.50 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -0.13 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.0169 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 0.18 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -0.26 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.44 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.1936 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; -0.84 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -1.13 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.29 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.0841 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 1.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.28 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.32 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.1024 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Compute mean squared error (MSE):

`$$\text{MSE(model)} = \frac{1}{N} \sum_{i=1}^N (\widehat{f}(x_i)-y_i)^2 = \frac{0.02 + 0.19 + 0.08 + 0.10}{4} = 0.10$$`

---




### Computing out of sample `\(R^2\)`

If we had no model, our best decision rule would be to predict new outcomes using the sample mean of our training data: 0.37. 

--

If we did that, our MSE would be: 

`$$\text{MSE(mean)} = \frac{1}{N} \sum_{i=1}^N (0.37-y_i)^2 =  1.06$$`

--

A model-based MSE would hopefully be lower than the MSE of the mean value of outcomes in the training data. 

---

### Computing out of sample `\(R^2\)`

The quantity `$$1 - \frac{\text{MSE(model)}}{\text{MSE(mean)}}$$` will be 

- close to 1 if MSE(model) is much less than MSE(mean) 

- close to 0 if MSE(model) is about the same as MSE(mean)

- 0 or lower if MSE(model) &gt; MSE(mean).

--

Since this formula is very similar to the `\(R^2\)` formula from linear models, it is often called the out-of-sample `\(R^2\)`. 


---
layout: false
class: middle, center

&lt;img src="index_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /&gt;

---
layout: true
background-image: url(figs/tidymodels.png)
background-position: 95% 2.5%
background-size: 13%

---

### Step-by-step example

Make a training / testing split of the `Sacramento` data.


```r
library(rsample)

*split &lt;- initial_split(Sacramento)
train &lt;- training(split)
test  &lt;- testing(split)
```


```
## &lt;699/233/932&gt;
```

---

### Step-by-step example

create the training data.


```r
library(rsample)

split &lt;- initial_split(Sacramento) 
*train &lt;- training(split)
test  &lt;- testing(split)
```


```
## # A tibble: 699 x 7
##     beds baths  sqft type         price latitude longitude
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;        &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     2     1   836 Residential  59222     38.6     -121.
##  2     3     1  1167 Residential  68212     38.5     -121.
##  3     2     1   852 Residential  69307     38.6     -121.
##  4     3     1  1122 Condo        89921     38.7     -121.
##  5     3     2  1104 Residential  90895     38.7     -121.
##  6     3     1  1177 Residential  91002     38.5     -121.
##  7     2     2   941 Condo        94905     38.6     -121.
##  8     3     2  1146 Residential  98937     38.7     -121.
##  9     3     2   909 Residential 100309     38.6     -121.
## 10     3     2  1289 Residential 106250     38.5     -121.
## # ... with 689 more rows
```

---

### Step-by-step example

create the testing data.


```r
library(rsample)

split &lt;- initial_split(Sacramento) 
train &lt;- training(split) 
*test  &lt;- testing(split)
```


```
## # A tibble: 233 x 7
##     beds baths  sqft type         price latitude longitude
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;        &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     3     1  1122 Condo        89921     38.7     -121.
##  2     3     2   909 Residential 100309     38.6     -121.
##  3     2     1   844 Residential 113263     38.7     -121.
##  4     2     1   588 Residential 120000     38.6     -121.
##  5     3     1   963 Residential 127281     38.5     -121.
##  6     2     2  1039 Condo       133000     38.4     -121.
##  7     3     2  1380 Residential 136500     38.6     -121.
##  8     3     2  1418 Residential 146250     38.5     -121.
##  9     2     2  1043 Residential 161250     38.7     -121.
## 10     4     2  1587 Residential 161500     38.7     -121.
## # ... with 223 more rows
```

---

### Step-by-step example

Uh-oh, missing values! 

Thinking this through would take another lecture, so we'll do something a little ad-hoc.


```r
get_summary &lt;- function(variable){
  if(is.factor(variable)){
    counts &lt;- table(variable)
    output &lt;- names(counts)[which.max(counts)]
  } else {
    output &lt;- mean(variable, na.rm = TRUE)
  }
  output
}

*train_impute_vals &lt;- map(train, .f = get_summary)
```


```
## # A tibble: 1 x 6
##   baths  beds latitude longitude  sqft type       
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
## 1  2.06  3.29     38.6     -121. 1665. Residential
```

---

### Step-by-step example

Training values are used to fill in missing cells 


```r
xnames &lt;- setdiff(names(train), 'price')

for(i in xnames){
  
  trn_na &lt;- is.na(train[[i]])
  tst_na &lt;- is.na(test[[i]])
  
  train[trn_na, i] &lt;- train_impute_vals[[i]]
  test[tst_na, i] &lt;- train_impute_vals[[i]]
  
}

nrow(drop_na(train))
```

```
## [1] 699
```

```r
nrow(drop_na(test))
```

```
## [1] 233
```

---

### Step-by-step example

Fit a step-wise model


```r
full &lt;- glue("price ~ {glue_collapse(xnames, sep = '+')}")

step_mdl &lt;- stepAIC(
  object = lm(price ~ 1, data = train),
  scope = as.formula(full),
  direction = 'both',
  steps = 100,
  trace = 0
)

step_mdl$coefficients
```

```
##      (Intercept)             sqft        longitude             beds 
##    16098647.6220         143.9731      151870.5562      -18947.6564 
##         latitude typeMulti_Family  typeResidential 
##       61611.5658      -35072.0647       20890.7501
```

---

### Step-by-step example

Fit a `glmnet` model


```r
X_trn &lt;- model.matrix( ~ ., data = train[, xnames])
X_trn &lt;- X_trn[,-1]

X_tst &lt;- model.matrix( ~ ., data = test[, xnames])
X_tst &lt;- X_tst[,-1]

net_mdl &lt;- cv.glmnet(x = X_trn, y = train$price)

coefficients(net_mdl, s = 'lambda.1se')
```

```
## 8 x 1 sparse Matrix of class "dgCMatrix"
##                             1
## (Intercept)      7734903.0310
## beds                   .     
## baths                  .     
## sqft                 105.6472
## typeMulti_Family       .     
## typeResidential        .     
## latitude               .     
## longitude          63193.6547
```

---

### Step-by-step example

Get predictions from each model


```r
step_prd &lt;- predict(step_mdl, newdata = test)
net_prd  &lt;- predict(net_mdl, s = 'lambda.1se', newx = X_tst)

plot(step_prd, net_prd)
```

![](index_files/figure-html/unnamed-chunk-54-1.png)&lt;!-- --&gt;

---

### Step-by-step example

evaluate predictions from each model


```r
ybar &lt;- mean(train$price)

eval_prd &lt;- function(pred, resp){
  pred_mse &lt;- mean( (pred - resp)^2 )
  refr_mse &lt;- mean( (ybar - resp)^2 )
  1 - pred_mse / refr_mse
}

list(net = net_prd, step = step_prd) %&gt;% 
  map_dbl(eval_prd, resp = test$price)
```

```
##       net      step 
## 0.6116247 0.6820475
```

(hold for gasps)

---

### Step-by-step example

**Question:** wat? I thought step-wise models were bad!!

--

**Answer:** This is a prediction problem. 

No inferences were drawn from the step-wise model. 

P-values and standard errors from the step-wise model are likely to be biased.

--

However, our real estate agents don't care much for that. 

They don't need correct inference to make a deal happen. 

They need an accurate prediction.

--

**Thanks for listening!** Any questions?
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
